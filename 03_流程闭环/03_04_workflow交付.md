---
title: workflow交付
description: 掌握工作流的交付方式，让自动化成果能够服务于实际业务
---

# workflow交付

> **模块目标**: 掌握多种交付方式，让工作流真正服务于实际业务

---

## 一、workflow交付概述

### 1.1 什么是交付

**交付**是将开发完成的工作流投入实际使用的过程。

```
开发阶段 → 交付阶段 → 使用阶段
    ↓           ↓           ↓
搭建工作流 → 选择交付方式 → 实际业务使用
```

很多学习者止步于"能跑通"，却忽略了最重要的一步：**让工作流真正产生价值**。

### 1.2 交付的核心考量

在选择交付方式时，需要考虑以下因素：

| 考量维度 | 说明 | 关键问题 |
|---------|------|---------|
| **易用性** | 使用者是否容易上手 | 非技术人员能否使用？ |
| **稳定性** | 是否能长期稳定运行 | 出错如何处理？ |
| **可维护性** | 是否便于后续维护 | 如何更新迭代？ |
| **成本** | 运行成本是否可接受 | 服务器、API调用费用？ |

### 1.3 交付方式概览

| 交付方式 | 适用场景 | 易用性 | 灵活性 |
|---------|---------|-------|-------|
| Bot/Agent交付 | AI对话场景 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| API交付 | 系统集成 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 定时任务交付 | 周期性报表 | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 消息通知交付 | 信息推送 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

---

## 二、常见交付方式

### 2.1 Bot/Agent交付

将工作流封装成对话式AI助手，用户通过对话使用。

#### Coze Bot发布

**步骤1：创建Bot**

1. 在Coze中创建新Bot
2. 配置Bot的基本信息（名称、头像、简介）
3. 将工作流绑定到Bot

**步骤2：配置触发方式**

```
触发配置：
- 用户发送消息时触发工作流
- 支持关键词触发
- 支持意图识别触发
```

**步骤3：发布Bot**

```
发布渠道：
├── 飞书：发布到飞书机器人
├── 微信公众号：发布为公众号客服
├── 微信小程序：嵌入小程序
└── API：通过API调用
```

#### 适用场景

| 场景 | 说明 |
|-----|------|
| 智能客服 | 用户提问，AI自动回答 |
| 知识问答 | 企业知识库查询 |
| 内容生成 | 用户输入需求，AI生成内容 |
| 数据查询 | 对话式数据查询 |

#### 优缺点

- ✅ 用户体验好，自然对话交互
- ✅ 无需培训，上手即用
- ✅ 支持多轮对话
- ❌ 不适合批量处理
- ❌ 依赖平台（飞书、微信等）

### 2.2 API交付

将工作流暴露为HTTP API，供其他系统调用。

#### n8n Webhook使用

**步骤1：添加Webhook触发器**

```
节点配置：
- HTTP Method：POST
- Path：/api/report
- Authentication：Header Auth（可选）
```

**步骤2：激活工作流**

1. 点击右上角开关，激活工作流
2. 获取Webhook URL

```
URL格式：
https://your-n8n-domain.com/webhook/api/report

本地测试：
http://localhost:5678/webhook/api/report
```

**步骤3：调用API**

```bash
# curl调用示例
curl -X POST http://localhost:5678/webhook/api/report \
  -H "Content-Type: application/json" \
  -d '{
    "date": "2024-01-15",
    "type": "daily"
  }'
```

#### API文档编写

为你的API编写简单的文档：

```markdown
## 日报生成API

### 请求地址
POST /webhook/api/report

### 请求参数
| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| date | string | 是 | 日期，格式YYYY-MM-DD |
| type | string | 否 | 报告类型：daily/weekly |

### 返回示例
{
  "success": true,
  "report_url": "https://xxx.com/report.pdf"
}
```

#### 适用场景

| 场景 | 说明 |
|-----|------|
| 系统集成 | 其他系统调用你的工作流 |
| 前端应用 | 网页/APP后端服务 |
| 批量处理 | 批量调用API处理数据 |
| 自动化串联 | 多个工作流串联 |

#### 优缺点

- ✅ 灵活性高，可被任何系统调用
- ✅ 适合批量处理
- ✅ 便于系统集成
- ❌ 需要调用方有技术能力
- ❌ 需要考虑API安全

### 2.3 定时任务交付

工作流按设定的时间自动执行，无需人工干预。

#### 配置定时触发

**Coze定时触发**：
```
目前Coze对定时触发的支持有限
建议使用n8n或外部调度工具
```

**n8n Schedule Trigger**：

```
节点配置：
- Trigger Interval：Days
- Days Between Triggers：1
- Trigger at Hour：9
- Trigger at Minute：0

高级配置：
- Cron表达式：自定义复杂时间规则
  例如：0 9 * * 1-5（工作日早上9点）
```

#### 常见定时场景

| 时间规则 | Cron表达式 | 说明 |
|---------|-----------|------|
| 每天早上9点 | `0 9 * * *` | 日报生成 |
| 每周一早上9点 | `0 9 * * 1` | 周报生成 |
| 每月1号 | `0 9 1 * *` | 月报生成 |
| 工作日早上9点 | `0 9 * * 1-5` | 工作日提醒 |
| 每小时 | `0 * * * *` | 数据同步 |

#### 适用场景

| 场景 | 说明 |
|-----|------|
| 报表生成 | 每日/周/月自动生成报表 |
| 数据同步 | 定时同步数据 |
| 监控告警 | 定时检查并发送告警 |
| 内容推送 | 定时推送内容 |

#### 优缺点

- ✅ 完全自动化，无需人工干预
- ✅ 适合周期性任务
- ✅ 可预测的执行时间
- ❌ 不适合实时性要求高的场景
- ❌ 需要确保服务器稳定运行

### 2.4 消息通知交付

将工作流的执行结果通过消息渠道推送。

#### 邮件推送

**n8n Email节点配置**：

```
节点：Send Email

配置：
- From Email：noreply@company.com
- To Email：recipient@company.com
- Subject：日报 - {{date}}
- Text/HTML：邮件内容

SMTP配置：
- Host：smtp.company.com
- Port：465
- User：noreply@company.com
- Password：***
```

#### 企业微信/钉钉推送

**企业微信机器人**：

```javascript
// Code节点：发送企业微信消息
const webhookUrl = 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY';

const message = {
  msgtype: 'markdown',
  markdown: {
    content: `## 日报通知\n> 日期：${date}\n> 销售额：¥${totalSales}\n> [点击查看详情](${reportUrl})`
  }
};

// 使用HTTP Request节点发送
return [{
  json: {
    url: webhookUrl,
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(message)
  }
}];
```

**钉钉机器人**：

```javascript
// 钉钉消息格式
const message = {
  msgtype: 'markdown',
  markdown: {
    title: '日报通知',
    text: `## 日报通知\n- 日期：${date}\n- 销售额：¥${totalSales}\n- [查看详情](${reportUrl})`
  }
};
```

#### Telegram Bot

```
节点：Telegram

配置：
- Operation：Send Message
- Chat ID：目标群组/用户ID
- Text：消息内容

支持格式：
- 纯文本
- Markdown
- HTML
```

#### 适用场景

| 场景 | 推荐渠道 |
|-----|---------|
| 企业内部通知 | 企业微信、钉钉 |
| 客户通知 | 邮件、短信 |
| 个人提醒 | Telegram、微信 |
| 告警通知 | 企业微信、钉钉、邮件 |

---

## 三、交付最佳实践

### 3.1 错误处理机制

#### 异常捕获

```
错误处理策略：

1. 节点级别
   n8n：Settings → Continue On Fail
   Coze：添加条件分支处理异常

2. 工作流级别
   n8n：添加Error Trigger节点
   Coze：添加异常处理分支

3. 全局级别
   监控工作流执行状态
   失败时发送告警
```

#### 失败通知

```
错误通知工作流：

工作流执行失败
    ↓
Error Trigger捕获
    ↓
获取错误信息
    ↓
发送告警消息
    ↓
记录错误日志
```

#### 自动重试

```
重试配置：
- 重试次数：3次
- 重试间隔：指数退避（1s, 2s, 4s）
- 重试条件：网络错误、超时

适用场景：
- 调用外部API
- 网络请求
- 数据库操作
```

### 3.2 日志与监控

#### 运行日志记录

```
日志应包含：
- 执行时间
- 输入参数
- 执行结果
- 错误信息（如有）
- 执行耗时
```

#### 性能监控

```
监控指标：
- 执行成功率
- 平均执行时间
- 错误类型分布
- API调用次数

工具推荐：
- n8n内置执行历史
- 外部监控：Prometheus + Grafana
```

#### 问题排查

```
排查步骤：
1. 查看执行历史
2. 检查节点输出
3. 分析错误信息
4. 复现问题
5. 修复并测试
```

### 3.3 文档与交接

#### 使用说明

```markdown
## 工作流使用说明

### 功能描述
本工作流用于自动生成每日销售日报

### 使用方法
1. 工作流每天早上9点自动执行
2. 执行完成后会发送邮件到team@company.com
3. 如需手动执行，点击"Execute Workflow"

### 输入参数
无需手动输入参数

### 输出结果
- 邮件：包含日报内容
- 附件：Excel格式的详细数据

### 注意事项
- 确保Google Sheets有访问权限
- 如未收到邮件，检查垃圾邮件箱
```

#### 维护手册

```markdown
## 维护手册

### 常见问题
1. 工作流执行失败
   - 检查网络连接
   - 检查API凭证是否过期

2. 数据不准确
   - 检查数据源配置
   - 检查数据处理逻辑

### 更新记录
| 日期 | 版本 | 更新内容 |
|-----|------|---------|
| 2024-01-15 | 1.0 | 初始版本 |

### 联系方式
维护人：张三
邮箱：zhangsan@company.com
```

---

## 四、实战：完整工作流交付

### 4.1 需求：竞品监控日报

**场景描述**：
- 每天自动监控竞品价格
- 生成价格变化报告
- 发送到企业微信群

### 4.2 设计工作流

```
工作流设计：

Schedule Trigger（每天10点）
    ↓
HTTP Request（获取竞品数据）
    ↓
Code节点（数据处理）
    ↓
Code节点（价格对比）
    ↓
条件分支（有变化？）
    ↓是                ↓否
生成报告            记录日志
    ↓
企业微信推送
```

### 4.3 选择交付方式

根据需求分析：
- ✅ 定时执行 → Schedule Trigger
- ✅ 消息推送 → 企业微信群机器人
- ✅ 无需人工干预 → 全自动

### 4.4 部署上线

#### 步骤1：创建企业微信群机器人

1. 在企业微信群中添加机器人
2. 获取Webhook地址

#### 步骤2：配置工作流

```javascript
// 企业微信消息格式
const message = {
  msgtype: 'markdown',
  markdown: {
    content: `## 竞品价格监控日报
> 日期：${date}

### 价格变化
${changes.map(c => `- **${c.product}**：${c.oldPrice} → ${c.newPrice}（${c.change}%）`).join('\n')}

### 详情链接
[点击查看完整报告](${reportUrl})`
  }
};
```

#### 步骤3：测试验证

1. 手动执行工作流
2. 检查企业微信消息
3. 验证数据准确性

#### 步骤4：激活定时任务

1. 激活工作流
2. 监控首次自动执行
3. 确认稳定运行

### 4.5 监控与迭代

#### 监控指标

| 指标 | 目标 | 告警阈值 |
|-----|------|---------|
| 执行成功率 | >99% | <95% |
| 执行时间 | <30s | >60s |
| 数据准确性 | 100% | 任何错误 |

#### 迭代优化

```
优化方向：
1. 增加更多竞品监控
2. 添加价格趋势图表
3. 支持自定义监控频率
4. 添加异常价格告警
```

---

## 五、本章小结

### 核心要点回顾

1. **交付方式选择**：根据场景选择Bot/API/定时/消息通知
2. **错误处理**：异常捕获、失败通知、自动重试
3. **日志监控**：记录执行日志、监控性能指标
4. **文档交接**：编写使用说明和维护手册

### 交付方式对比

| 交付方式 | 优点 | 缺点 | 适用场景 |
|---------|------|------|---------|
| Bot/Agent | 交互友好 | 依赖平台 | AI对话场景 |
| API | 灵活可控 | 需技术能力 | 系统集成 |
| 定时任务 | 全自动 | 不够灵活 | 周期性任务 |
| 消息通知 | 即时触达 | 单向推送 | 信息推送 |

### 自检清单

完成本章学习后，问问自己：

- [ ] 我能根据场景选择合适的交付方式吗？
- [ ] 我能为工作流添加错误处理机制吗？
- [ ] 我能配置消息推送（企业微信/钉钉）吗？
- [ ] 我能编写工作流的使用说明吗？
- [ ] 我已经将一个工作流交付上线了吗？

### 下一步

完成本章学习后，你已掌握工作流编排的完整能力：

**→ [04_壁垒构建](../04_壁垒构建/04_00_index.md)**

在下一章中，你将学习如何构建自己的竞争壁垒，让自动化能力成为你的核心竞争力。

---

*交付是工作流价值的最后一公里。只有真正交付使用，自动化才能产生实际价值！*
